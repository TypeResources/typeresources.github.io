function getUrlGazeState(){for(var t,e=/\+/g,a=/([^&=]+)=?([^&]*)/g,n=function(t){return decodeURIComponent(t.replace(e," "))},r=window.location.search.substring(1),o={};t=a.exec(r);)o[n(t[1])]=n(t[2]);return o}function getLocalStorageGazeState(){return JSON.parse(localStorage.getItem("gazeState"))}function setLocalStorageState(){localStorage.setItem("gazeState",JSON.stringify(gazeState))}function updateUrl(){var t=getBaseUrl()+stateToUri();window.history.pushState("object or string","Title",t)}function getDomFontList(){return $fontsList.val()}function parseCsvToArray(t){var e=Papa.parse(t).data[0];return e.lastIndexOf("")!=-1&&e.pop(),e}function printGlyphGlazers(t){$gazeContainer.empty(),$.each(t,function(t,e){var a=e.trim(),n="",r=400;a.includes(":")?(n=a.split(":")[0],r=a.split(":")[1]):n=a,$gazeWrapper=$("<div></div>").addClass("gaze"),$gazeText=$("<div></div>").addClass("gaze__text"),$gazeMetrics=$("<div></div>").addClass("gaze__metrics").html(svg),$gazeText.html(gazeState.text),$gazeText.attr("contenteditable","true"),$gazeWrapper.css({"font-family":n,"font-weight":r,"text-align":gazeState.textAlign}),$gazeWrapper.attr("data-fontname",n),$gazeWrapper.append($gazeText,$gazeMetrics),$gazeContainer.append($gazeWrapper)})}function getGoogleFontsURI(t){var e="";return $.each(t,function(t,a){e+=a.trim(),e+="|"}),e=e.slice(0,-1),e=e.split(" ").join("+"),googleFontsUrl+e}function loadGoogleFonts(t){$("#font-loading").html("<style>@import '"+getGoogleFontsURI(t)+"';</style>")}function getBaseUrl(){return window.location.href.replace(/\?.*/,"")}function stateToUri(t){var e=["openType","textAlign","fonts","text"];uriStr="?";for(var a=e.length-1;a>=0;a--){var n=e[a],r=gazeState[n];r=r.replace(/, /g,","),r=encodeURI(r),r=r.replace(/#/g,"%23"),uriStr+=n+"=",uriStr+=r,uriStr+="&"}return uriStr=uriStr.slice(0,-1),uriStr}function prettifyCSV(t){return t.replace(/,/g,", ")}function resetToDefaults(){gazeState={},gazeState=$.extend({},gazeState,gazeStateDefaults)}function csvValuesToStringValues(t){return t=t.replace(/ /g,""),t='"'+t,t=t.replace(/,/g,'", "'),t+='"'}function updateOpenTypeCss(t){gazeState.openType=t,setLocalStorageState();var e=gazeState.openType;e=e.replace(/ /g,"");for(var a=e.split(","),n=[],r=0;r<a.length;r++)4==a[r].length&&n.push(a[r]);var o=csvValuesToStringValues(n.toString());$gazeContainer.attr("style","font-feature-settings: "+o)}var gazeState={},gazeStateDefaults={text:"Adhesion",fonts:"Open Sans, Roboto:900, Source Sans Pro:200",textAlign:"center",openType:"frac"},localStorageGazeState=localStorage.getItem("gazeState"),$gazeContainer=$("#gaze-container"),$gazeInputFonts=$("#gaze-fonts"),$gazeInputOpenType=$("#gaze-opentype"),$fontsList=$("#fonts-list"),$gazeSettingsButton=$("#gaze-settings button"),googleFontsUrl="https://fonts.googleapis.com/css?family=",svg='<svg><use xlink:href="#lines"/></svg>';$gazeContainer.keyup(function(t){var e=$(t.target),a=e.text();e.parent().siblings().children(".gaze__text").html(a),gazeState.text=a,setLocalStorageState()}),$gazeInputFonts.keyup(function(t){gazeState.fonts=$(this).val(),setLocalStorageState(),loadGoogleFonts(parseCsvToArray(gazeState.fonts)),printGlyphGlazers(parseCsvToArray(gazeState.fonts))}),$gazeInputOpenType.keyup(function(t){var e=$(this).val();updateOpenTypeCss(e)}),$gazeSettingsButton.on("click",function(){$this=$(this),$this.hasClass("align-left")?gazeState.textAlign="left":$this.hasClass("align-center")?gazeState.textAlign="center":$this.hasClass("align-right")?gazeState.textAlign="right":$this.hasClass("share-url")?updateUrl():$this.hasClass("reset")&&(resetToDefaults(),$gazeInputFonts.val(prettifyCSV(gazeState.fonts)),$gazeInputOpenType.val(prettifyCSV(gazeState.openType)),printGlyphGlazers(parseCsvToArray(gazeState.fonts)),updateOpenTypeCss(gazeState.openType)),setLocalStorageState(),$(".gaze").css("text-align",gazeState.textAlign)}),$("#gaze-zoom").on("change click",function(){var t=100*$("#gaze-zoom").val()+"%";$(".gaze").children().css("font-size",t)}),svg4everybody(),gazeState=$.extend({},gazeState,gazeStateDefaults),gazeState=$.extend({},gazeState,getLocalStorageGazeState()),gazeState=$.extend({},gazeState,getUrlGazeState()),setLocalStorageState(),$gazeInputFonts.val(prettifyCSV(gazeState.fonts)),$gazeInputOpenType.val(prettifyCSV(gazeState.openType)),loadGoogleFonts(parseCsvToArray(gazeState.fonts)),printGlyphGlazers(parseCsvToArray(gazeState.fonts)),updateOpenTypeCss(gazeState.openType);