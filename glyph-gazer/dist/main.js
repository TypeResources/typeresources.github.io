function getUrlGazeState(){for(var e,t=/\+/g,a=/([^&=]+)=?([^&]*)/g,o=function(e){return decodeURIComponent(e.replace(t," "))},n=window.location.search.substring(1),s={};e=a.exec(n);)s[o(e[1])]=o(e[2]);return s}function getLocalStorageGazeState(){return JSON.parse(localStorage.getItem("gazeState"))}function setLocalStorageState(){localStorage.setItem("gazeState",JSON.stringify(gazeState))}function updateUrl(){var e=getBaseUrl()+stateToUri();window.history.pushState("object or string","Title",e)}function getDomFontList(){return $fontsList.val()}function parseCsvToArray(e){var t=Papa.parse(e).data[0];return t.lastIndexOf("")!=-1&&t.pop(),t}function printGlyphGlazers(e){$gazeContainer.empty(),$.each(e,function(e,t){var a=t.trim(),o="",n=400;a.includes(":")?(o=a.split(":")[0],n=a.split(":")[1]):o=a,$gazeWrapper=$("<div></div>").addClass("gaze"),$gazeText=$("<div></div>").addClass("gaze__text"),$gazeMetrics=$("<div></div>").addClass("gaze__metrics hideable").html(svg),$gazeText.html(gazeState.text),$gazeText.attr("contenteditable","true"),$gazeWrapper.css({"font-family":o,"font-weight":n,"text-align":gazeState.textAlign}),$gazeWrapper.attr("data-fontname",o),$gazeWrapper.append($gazeText,$gazeMetrics),$gazeContainer.append($gazeWrapper),updateZoomCss(gazeState.zoom)})}function getGoogleFontsURI(e){var t="";return $.each(e,function(e,a){t+=a.trim(),t+="|"}),t=t.slice(0,-1),t=t.split(" ").join("+"),googleFontsUrl+t}function loadGoogleFonts(e){$("#font-loading").html("<style>@import '"+getGoogleFontsURI(e)+"';</style>")}function getBaseUrl(){return window.location.href.replace(/\?.*/,"")}function stateToUri(e){var t=["text","fonts","openType","textAlign","zoom"];uriStr="?";for(var a=0;a<t.length;a++){var o=t[a],n=gazeState[o];n=n.replace(/, /g,","),n=encodeURI(n),n=n.replace(/#/g,"%23"),uriStr+=o+"=",uriStr+=n,uriStr+="&"}return uriStr=uriStr.slice(0,-1),uriStr}function prettifyCSV(e){return e=e.replace(/,   /g,","),e=e.replace(/,  /g,","),e=e.replace(/, /g,","),e.replace(/,/g,", ")}function resetToDefaults(){gazeState=$.extend({},{},gazeStateDefaults),$("body").removeClass()}function csvValuesToStringValues(e){return e=e.replace(/ /g,""),e='"'+e,e=e.replace(/,/g,'", "'),e+='"'}function updateOpenTypeCss(e){gazeState.openType=e,setLocalStorageState();var t=gazeState.openType;t=t.replace(/ /g,"");for(var a=t.split(","),o=[],n=0;n<a.length;n++)4==a[n].length&&o.push(a[n]);var s=csvValuesToStringValues(o.toString());$gazeContainer.attr("style","font-feature-settings: "+s)}function updateZoomCss(e){var t=100*e,a=t+"%";$(".gaze").children().css("font-size",a)}var gazeState={},gazeStateDefaults={text:"Adhesion",fonts:"Open Sans, Roboto:900, Source Sans Pro:200",textAlign:"center",openType:"frac",zoom:"1"},localStorageGazeState=localStorage.getItem("gazeState"),$gazeContainer=$("#gaze-container"),$gazeInputFonts=$("#gaze-fonts"),$gazeInputOpenType=$("#gaze-opentype"),$gazeInputZoom=$("#gaze-zoom"),$fontsList=$("#fonts-list"),$gazeSettingsButton=$("#gaze-settings button"),googleFontsUrl="https://fonts.googleapis.com/css?family=",svg='<svg><use xlink:href="#lines"/></svg>';$gazeContainer.keyup(function(e){var t=$(e.target),a=t.text();t.parent().siblings().children(".gaze__text").html(a),gazeState.text=a,setLocalStorageState()}),$gazeInputFonts.keyup(function(e){gazeState.fonts=$(this).val(),setLocalStorageState(),loadGoogleFonts(parseCsvToArray(gazeState.fonts)),printGlyphGlazers(parseCsvToArray(gazeState.fonts))}),$gazeInputOpenType.keyup(function(e){var t=$(this).val();updateOpenTypeCss(t)}),$gazeSettingsButton.on("click",function(){$this=$(this),$this.hasClass("align-left")?gazeState.textAlign="left":$this.hasClass("align-center")?gazeState.textAlign="center":$this.hasClass("align-right")?gazeState.textAlign="right":$this.hasClass("share-url")?updateUrl():$this.hasClass("reset")?(resetToDefaults(),$gazeInputFonts.val(prettifyCSV(gazeState.fonts)),$gazeInputOpenType.val(prettifyCSV(gazeState.openType)),$gazeInputZoom.val(gazeState.zoom),printGlyphGlazers(parseCsvToArray(gazeState.fonts)),updateOpenTypeCss(gazeState.openType),updateZoomCss(gazeState.openType)):$this.hasClass("toggle-lines")&&$("body").toggleClass("hide-stuff"),setLocalStorageState(),$(".gaze").css("text-align",gazeState.textAlign)}),$gazeInputZoom.on("change click",function(){var e=$(this).val();gazeState.zoom=e,setLocalStorageState(),updateZoomCss(gazeState.zoom)}),svg4everybody(),gazeState=$.extend({},gazeState,gazeStateDefaults),gazeState=$.extend({},gazeState,getLocalStorageGazeState()),gazeState=$.extend({},gazeState,getUrlGazeState()),setLocalStorageState(),$gazeInputFonts.val(prettifyCSV(gazeState.fonts)),$gazeInputOpenType.val(prettifyCSV(gazeState.openType)),$gazeInputZoom.val(gazeState.zoom),loadGoogleFonts(parseCsvToArray(gazeState.fonts)),printGlyphGlazers(parseCsvToArray(gazeState.fonts)),updateOpenTypeCss(gazeState.openType),updateZoomCss(gazeState.zoom);