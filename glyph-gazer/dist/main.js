function getUrlGazeState(){for(var e,t=/\+/g,a=/([^&=]+)=?([^&]*)/g,o=function(e){return decodeURIComponent(e.replace(t," "))},n=window.location.search.substring(1),r={};e=a.exec(n);)r[o(e[1])]=o(e[2]);return r}function getLocalStorageGazeState(){return JSON.parse(localStorage.getItem("gazeState"))}function setLocalStorageState(){localStorage.setItem("gazeState",JSON.stringify(gazeState))}function updateUrl(){var e=getBaseUrl()+stateToUri();window.history.pushState("object or string","Title",e)}function clearUrl(){var e=window.location.href,t=getBaseUrl();e!=t&&(window.history.pushState("object or string","Title",t),console.log("URL cleared"))}function getDomFontList(){return $fontsList.val()}function parseCsvToArray(e){var t=Papa.parse(e).data[0];return t.lastIndexOf("")!=-1&&t.pop(),t}function updateViewGlyphGazers(e){$gazeContainer.empty(),$.each(e,function(e,t){var a=t.trim(),o="",n=400;a.includes(":")?(o=a.split(":")[0],n=a.split(":")[1]):o=a,$gazeWrapper=$("<div></div>").addClass("gaze"),$gazeText=$("<div></div>").addClass("gaze__text"),$gazeMetrics=$("<div></div>").addClass("gaze__metrics hideable").html(svg),$gazeText.html(gazeState.text),$gazeText.attr("contenteditable","true"),$gazeWrapper.css({"font-family":o,"font-weight":n,"text-align":gazeState.textAlign}),$gazeWrapper.attr("data-fontname",o),$gazeWrapper.append($gazeText,$gazeMetrics),$gazeContainer.append($gazeWrapper),updateViewZoom(gazeState.zoom)})}function getGoogleFontsURI(e){var t="";return $.each(e,function(e,a){t+=a.trim(),t+="|"}),t=t.slice(0,-1),t=t.split(" ").join("+"),googleFontsUrl+t}function loadGoogleFonts(e){$("#font-loading").html("<style>@import '"+getGoogleFontsURI(e)+"';</style>")}function getBaseUrl(){return window.location.href.replace(/\?.*/,"")}function stateToUri(e){var t=["text","fonts","openType","textAlign","zoom"];uriStr="?";for(var a=0;a<t.length;a++){var o=t[a],n=gazeState[o];n=n.replace(/, /g,","),n=encodeURI(n),n=n.replace(/#/g,"%23"),uriStr+=o+"=",uriStr+=n,uriStr+="&"}return uriStr=uriStr.slice(0,-1),uriStr}function prettifyCSV(e){return e=e.replace(/,   /g,","),e=e.replace(/,  /g,","),e=e.replace(/, /g,","),e.replace(/,/g,", ")}function resetToDefaults(){gazeState=$.extend({},{},gazeStateDefaults),$("body").removeClass()}function csvValuesToStringValues(e){return e=e.replace(/ /g,""),e='"'+e,e=e.replace(/,/g,'", "'),e+='"'}function updateViewOpenType(e){var t=gazeState.openType;t=t.replace(/ /g,"");for(var a=t.split(","),o=[],n=0;n<a.length;n++)4==a[n].length&&o.push(a[n]);var r=csvValuesToStringValues(o.toString());r.indexOf("kern")==-1&&(r+=', "kern" off'),r.indexOf("liga")==-1&&(r+=', "liga" off'),r.indexOf("calt")==-1&&(r+=', "calt" off'),$gazeContainer.attr("style","font-feature-settings: "+r)}function updateViewZoom(e){var t=100*e,a=t+"%";$(".gaze").children().css("font-size",a)}var gazeState={},gazeStateDefaults={text:"Adhesion",fonts:"Open Sans, Roboto:900, Source Sans Pro:200",textAlign:"center",openType:"kern, calt, liga",zoom:"1"},localStorageGazeState=localStorage.getItem("gazeState"),$gazeContainer=$("#gaze-container"),$gazeInputFonts=$("#gaze-fonts"),$gazeInputOpenType=$("#gaze-opentype"),$gazeInputZoom=$("#gaze-zoom"),$fontsList=$("#fonts-list"),$gazeSettingsButton=$("#gaze-settings button"),googleFontsUrl="https://fonts.googleapis.com/css?family=",svg='<svg><use xlink:href="#lines"/></svg>';$gazeContainer.keyup(function(e){var t=$(e.target),a=t.text();t.parent().siblings().children(".gaze__text").html(a),clearUrl(),gazeState.text=a,setLocalStorageState()}),$gazeInputFonts.keyup(function(e){gazeState.fonts=$(this).val(),setLocalStorageState(),loadGoogleFonts(parseCsvToArray(gazeState.fonts)),clearUrl(),updateViewGlyphGazers(parseCsvToArray(gazeState.fonts))}),$gazeInputOpenType.keyup(function(e){var t=$(this).val();gazeState.openType=prettifyCSV(t),setLocalStorageState(),clearUrl(),updateViewOpenType(gazeState.openType)}),$gazeSettingsButton.on("click",function(){$this=$(this);var e=!1;$this.hasClass("align-left")?(gazeState.textAlign="left",$(".gaze").css("text-align",gazeState.textAlign)):$this.hasClass("align-center")?(gazeState.textAlign="center",$(".gaze").css("text-align",gazeState.textAlign)):$this.hasClass("align-right")?(gazeState.textAlign="right",$(".gaze").css("text-align",gazeState.textAlign)):$this.hasClass("share-url")?(e=!0,updateUrl()):$this.hasClass("reset")?(resetToDefaults(),$gazeInputFonts.val(prettifyCSV(gazeState.fonts)),$gazeInputOpenType.val(prettifyCSV(gazeState.openType)),$gazeInputZoom.val(gazeState.zoom),updateViewGlyphGazers(parseCsvToArray(gazeState.fonts)),updateViewOpenType(gazeState.openType),updateViewZoom(gazeState.openType)):$this.hasClass("toggle-lines")&&$("body").toggleClass("hide-stuff"),e||clearUrl(),setLocalStorageState()}),$gazeInputZoom.on("change click",function(){var e=$(this).val();gazeState.zoom=e,setLocalStorageState(),clearUrl(),updateViewZoom(gazeState.zoom)}),svg4everybody(),gazeState=$.extend({},gazeState,gazeStateDefaults),gazeState=$.extend({},gazeState,getLocalStorageGazeState()),gazeState=$.extend({},gazeState,getUrlGazeState()),setLocalStorageState(),loadGoogleFonts(parseCsvToArray(gazeState.fonts)),$gazeInputFonts.val(prettifyCSV(gazeState.fonts)),$gazeInputOpenType.val(prettifyCSV(gazeState.openType)),$gazeInputZoom.val(gazeState.zoom),updateViewGlyphGazers(parseCsvToArray(gazeState.fonts)),updateViewOpenType(gazeState.openType),updateViewZoom(gazeState.zoom);