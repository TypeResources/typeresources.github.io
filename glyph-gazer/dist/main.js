function getUrlGazeState(){for(var e,t=/\+/g,a=/([^&=]+)=?([^&]*)/g,n=function(e){return decodeURIComponent(e.replace(t," "))},s=window.location.search.substring(1),o={};e=a.exec(s);)o[n(e[1])]=n(e[2]);return o}function getLocalStorageGazeState(){return JSON.parse(localStorage.getItem("gazeState"))}function setLocalStorageState(){localStorage.setItem("gazeState",JSON.stringify(gazeState))}function updateUrl(){var e=getBaseUrl()+stateToUri();window.history.pushState("object or string","Title",e)}function getDomFontList(){return $fontsList.val()}function parseCsvToArray(e){var t=Papa.parse(e).data[0];return t.lastIndexOf("")!=-1&&t.pop(),t}function printGlyphGlazers(e){$gazeContainer.empty(),$.each(e,function(e,t){var a=t.trim(),n="",s=400;a.includes(":")?(n=a.split(":")[0],s=a.split(":")[1]):n=a,$gazeWrapper=$("<div></div>").addClass("gaze"),$gazeText=$("<div></div>").addClass("gaze__text"),$gazeMetrics=$("<div></div>").addClass("gaze__metrics hideable").html(svg),$gazeText.html(gazeState.text),$gazeText.attr("contenteditable","true"),$gazeWrapper.css({"font-family":n,"font-weight":s,"text-align":gazeState.textAlign}),$gazeWrapper.attr("data-fontname",n),$gazeWrapper.append($gazeText,$gazeMetrics),$gazeContainer.append($gazeWrapper)})}function getGoogleFontsURI(e){var t="";return $.each(e,function(e,a){t+=a.trim(),t+="|"}),t=t.slice(0,-1),t=t.split(" ").join("+"),googleFontsUrl+t}function loadGoogleFonts(e){$("#font-loading").html("<style>@import '"+getGoogleFontsURI(e)+"';</style>")}function getBaseUrl(){return window.location.href.replace(/\?.*/,"")}function stateToUri(e){var t=["openType","textAlign","fonts","text"];uriStr="?";for(var a=t.length-1;a>=0;a--){var n=t[a],s=gazeState[n];s=s.replace(/, /g,","),s=encodeURI(s),s=s.replace(/#/g,"%23"),uriStr+=n+"=",uriStr+=s,uriStr+="&"}return uriStr=uriStr.slice(0,-1),uriStr}function prettifyCSV(e){return e.replace(/,/g,", ")}function resetToDefaults(){gazeState={},gazeState=$.extend({},gazeState,gazeStateDefaults),$("body").removeClass()}function csvValuesToStringValues(e){return e=e.replace(/ /g,""),e='"'+e,e=e.replace(/,/g,'", "'),e+='"'}function updateOpenTypeCss(e){gazeState.openType=e,setLocalStorageState();var t=gazeState.openType;t=t.replace(/ /g,"");for(var a=t.split(","),n=[],s=0;s<a.length;s++)4==a[s].length&&n.push(a[s]);var o=csvValuesToStringValues(n.toString());$gazeContainer.attr("style","font-feature-settings: "+o)}var gazeState={},gazeStateDefaults={text:"Adhesion",fonts:"Open Sans, Roboto:900, Source Sans Pro:200",textAlign:"center",openType:"frac"},localStorageGazeState=localStorage.getItem("gazeState"),$gazeContainer=$("#gaze-container"),$gazeInputFonts=$("#gaze-fonts"),$gazeInputOpenType=$("#gaze-opentype"),$fontsList=$("#fonts-list"),$gazeSettingsButton=$("#gaze-settings button"),googleFontsUrl="https://fonts.googleapis.com/css?family=",svg='<svg><use xlink:href="#lines"/></svg>';$gazeContainer.keyup(function(e){var t=$(e.target),a=t.text();t.parent().siblings().children(".gaze__text").html(a),gazeState.text=a,setLocalStorageState()}),$gazeInputFonts.keyup(function(e){gazeState.fonts=$(this).val(),setLocalStorageState(),loadGoogleFonts(parseCsvToArray(gazeState.fonts)),printGlyphGlazers(parseCsvToArray(gazeState.fonts))}),$gazeInputOpenType.keyup(function(e){var t=$(this).val();updateOpenTypeCss(t)}),$gazeSettingsButton.on("click",function(){$this=$(this),$this.hasClass("align-left")?gazeState.textAlign="left":$this.hasClass("align-center")?gazeState.textAlign="center":$this.hasClass("align-right")?gazeState.textAlign="right":$this.hasClass("share-url")?updateUrl():$this.hasClass("reset")?(resetToDefaults(),$gazeInputFonts.val(prettifyCSV(gazeState.fonts)),$gazeInputOpenType.val(prettifyCSV(gazeState.openType)),printGlyphGlazers(parseCsvToArray(gazeState.fonts)),updateOpenTypeCss(gazeState.openType)):$this.hasClass("toggle-lines")&&$("body").toggleClass("hide-stuff"),setLocalStorageState(),$(".gaze").css("text-align",gazeState.textAlign)}),$("#gaze-zoom").on("change click",function(){var e=100*$("#gaze-zoom").val()+"%";$(".gaze").children().css("font-size",e)}),svg4everybody(),gazeState=$.extend({},gazeState,gazeStateDefaults),gazeState=$.extend({},gazeState,getLocalStorageGazeState()),gazeState=$.extend({},gazeState,getUrlGazeState()),setLocalStorageState(),$gazeInputFonts.val(prettifyCSV(gazeState.fonts)),$gazeInputOpenType.val(prettifyCSV(gazeState.openType)),loadGoogleFonts(parseCsvToArray(gazeState.fonts)),printGlyphGlazers(parseCsvToArray(gazeState.fonts)),updateOpenTypeCss(gazeState.openType);